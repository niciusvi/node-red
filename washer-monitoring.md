# Node-RED Flow to send a notification to Alexa when the Dishwasher or Washing Machine finish the cycle
This project implements automation to monitor dishwasher usage using Node-RED, Home Assistant, and integration with Alexa devices. It controls the dishwasher's state, notifies when the cycle is complete, and checks conditions such as motion in the kitchen to stop the notifications.

## Flow

![image](https://github.com/user-attachments/assets/f5d4de64-9509-4a82-999e-096e34e45e58)

## Code
     [{"id":"e9b2d6eba604518c","type":"group","z":"0788ddb2e2fd1ae7","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["1ec051013c500525","f062e4d1dc22a67e","ef8881aa205bdab6","0d90c0fbb1e5a011","6911e73d8662e833","79036dbd64fe04eb","22b228499828d833","5a6445884c2426cb","effe9832c9cafb2b","e378f2edf503306e","d9c9d057f33805ef","4158c0c900464a12","6f78796466fda59a","271e6996c28ecf80","4a16547ab43d3c3c","40d349bb687626b5","ac97178a0a025e3e","1973e0e5228a83d5","48ec64a307b2fac6","check-state","check-notifications","send-notification","disable-notifications","2f58c2c0819d89c0","14f562b643809b13","ae7b442bf5603d76"],"x":34,"y":19,"w":1472,"h":702},{"id":"1ec051013c500525","type":"server-state-changed","z":"0788ddb2e2fd1ae7","g":"e9b2d6eba604518c","name":"Lava louças Power <= 2 por 10 min","server":"ce62d31.41e203","version":6,"outputs":2,"exposeAsEntityConfig":"","entities":{"entity":["sensor.tomada_lava_loucas_power"],"substring":[],"regex":[]},"outputInitially":false,"stateType":"num","ifState":"2","ifStateType":"num","ifStateOperator":"lte","outputOnlyOnStateChange":true,"for":"10","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"x":200,"y":360,"wires":[["6911e73d8662e833"],[]]},{"id":"f062e4d1dc22a67e","type":"switch","z":"0788ddb2e2fd1ae7","g":"e9b2d6eba604518c","name":"","property":"payload","propertyType":"msg","rules":[{"t":"gte","v":"10","vt":"str"},{"t":"gte","v":"80","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":330,"y":100,"wires":[["ef8881aa205bdab6"],["0d90c0fbb1e5a011"]]},{"id":"ef8881aa205bdab6","type":"api-call-service","z":"0788ddb2e2fd1ae7","g":"e9b2d6eba604518c","name":"Lava louças - Ligada","server":"ce62d31.41e203","version":7,"debugenabled":false,"action":"input_boolean.turn_on","floorId":[],"areaId":[],"deviceId":[],"entityId":["input_boolean.lava_loucas_on"],"labelId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"on","valueType":"str"}],"queue":"none","blockInputOverrides":true,"domain":"input_boolean","service":"turn_on","x":600,"y":60,"wires":[[]]},{"id":"0d90c0fbb1e5a011","type":"api-call-service","z":"0788ddb2e2fd1ae7","g":"e9b2d6eba604518c","name":"Lava louças - Funcionando","server":"ce62d31.41e203","version":7,"debugenabled":false,"action":"input_select.select_option","floorId":[],"areaId":[],"deviceId":[],"entityId":["input_select.lava_loucas_estado"],"labelId":[],"data":"{\"option\":\"Running\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"on","valueType":"str"}],"queue":"none","blockInputOverrides":true,"domain":"input_select","service":"select_option","x":620,"y":140,"wires":[[]]},{"id":"6911e73d8662e833","type":"api-current-state","z":"0788ddb2e2fd1ae7","g":"e9b2d6eba604518c","name":"Lava louças - Estava funcionado?","server":"ce62d31.41e203","version":3,"outputs":2,"halt_if":"Running","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_select.lava_loucas_estado","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":520,"y":360,"wires":[["79036dbd64fe04eb"],[]]},{"id":"79036dbd64fe04eb","type":"api-call-service","z":"0788ddb2e2fd1ae7","g":"e9b2d6eba604518c","name":"Mudar estado p/ limpo","server":"ce62d31.41e203","version":7,"debugenabled":false,"action":"input_select.select_option","floorId":[],"areaId":[],"deviceId":[],"entityId":["input_select.lava_loucas_estado"],"labelId":[],"data":"{\"option\":\"Clean\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","blockInputOverrides":true,"domain":"input_select","service":"select_option","x":850,"y":340,"wires":[["e378f2edf503306e"]]},{"id":"22b228499828d833","type":"alexa-remote-routine","z":"0788ddb2e2fd1ae7","g":"e9b2d6eba604518c","name":"TTS nas Alexas","account":"0b0dcfaefb34f2b7","routineNode":{"type":"speak","payload":{"type":"announcement","text":{"type":"str","value":"A lava louças terminou"},"devices":["G090XG12210201R1","G090XG1221760K8K","G090XG12212403GG"]}},"x":1400,"y":400,"wires":[[]]},{"id":"5a6445884c2426cb","type":"server-state-changed","z":"0788ddb2e2fd1ae7","g":"e9b2d6eba604518c","name":"Lava louças Power = 0 por 15 min","server":"ce62d31.41e203","version":6,"outputs":2,"exposeAsEntityConfig":"","entities":{"entity":["sensor.tomada_lava_loucas_power"],"substring":[],"regex":[]},"outputInitially":false,"stateType":"num","ifState":"0","ifStateType":"num","ifStateOperator":"is","outputOnlyOnStateChange":true,"for":"15","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"x":200,"y":420,"wires":[["effe9832c9cafb2b"],[]]},{"id":"effe9832c9cafb2b","type":"api-call-service","z":"0788ddb2e2fd1ae7","g":"e9b2d6eba604518c","name":"Lava louças - Desligada","server":"ce62d31.41e203","version":7,"debugenabled":false,"action":"input_boolean.turn_off","floorId":[],"areaId":[],"deviceId":[],"entityId":["input_boolean.lava_loucas_on"],"labelId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","blockInputOverrides":true,"domain":"input_boolean","service":"turn_off","x":190,"y":500,"wires":[["4a16547ab43d3c3c"]]},{"id":"e378f2edf503306e","type":"api-current-state","z":"0788ddb2e2fd1ae7","g":"e9b2d6eba604518c","name":"Lava louças - Ligada?","server":"ce62d31.41e203","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.lava_loucas_on","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":1140,"y":320,"wires":[["d9c9d057f33805ef"],[]]},{"id":"d9c9d057f33805ef","type":"delay","z":"0788ddb2e2fd1ae7","g":"e9b2d6eba604518c","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"30","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"allowrate":false,"outputs":1,"x":1150,"y":400,"wires":[["22b228499828d833"]]},{"id":"4158c0c900464a12","type":"server-state-changed","z":"0788ddb2e2fd1ae7","g":"e9b2d6eba604518c","name":"Lava louças Power","server":"ce62d31.41e203","version":6,"outputs":1,"exposeAsEntityConfig":"","entities":{"entity":["sensor.tomada_lava_loucas_power"],"substring":[],"regex":[]},"outputInitially":false,"stateType":"num","ifState":"","ifStateType":"str","ifStateOperator":"is","outputOnlyOnStateChange":true,"for":"5","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"x":150,"y":100,"wires":[["f062e4d1dc22a67e"]]},{"id":"6f78796466fda59a","type":"server-state-changed","z":"0788ddb2e2fd1ae7","g":"e9b2d6eba604518c","name":"Cozinha - Movimento","server":"ce62d31.41e203","version":6,"outputs":2,"exposeAsEntityConfig":"","entities":{"entity":["binary_sensor.sensor_presenca_cozinha_presence"],"substring":[],"regex":[]},"outputInitially":false,"stateType":"str","ifState":"on","ifStateType":"str","ifStateOperator":"is","outputOnlyOnStateChange":false,"for":"0","forType":"num","forUnits":"milliseconds","ignorePrevStateNull":true,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"x":160,"y":260,"wires":[["ac97178a0a025e3e"],["40d349bb687626b5"]]},{"id":"271e6996c28ecf80","type":"api-current-state","z":"0788ddb2e2fd1ae7","g":"e9b2d6eba604518c","name":"Sensor Presença Cozinha - Sem Movimento?","server":"ce62d31.41e203","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.movimento_na_cozinha","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"5","forType":"num","forUnits":"seconds","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":580,"y":500,"wires":[["check-state"],[]]},{"id":"4a16547ab43d3c3c","type":"delay","z":"0788ddb2e2fd1ae7","g":"e9b2d6eba604518c","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":510,"y":420,"wires":[["271e6996c28ecf80"]]},{"id":"40d349bb687626b5","type":"api-call-service","z":"0788ddb2e2fd1ae7","g":"e9b2d6eba604518c","name":"Sensor Cozinha - S/ Movimento","server":"ce62d31.41e203","version":7,"debugenabled":false,"action":"input_boolean.turn_off","floorId":[],"areaId":[],"deviceId":[],"entityId":["input_boolean.movimento_na_cozinha"],"labelId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","blockInputOverrides":true,"domain":"input_boolean","service":"turn_off","x":600,"y":220,"wires":[[]]},{"id":"ac97178a0a025e3e","type":"api-call-service","z":"0788ddb2e2fd1ae7","g":"e9b2d6eba604518c","name":"Sensor Cozinha - C/ Movimento","server":"ce62d31.41e203","version":7,"debugenabled":false,"action":"input_boolean.turn_on","floorId":[],"areaId":[],"deviceId":[],"entityId":["input_boolean.movimento_na_cozinha"],"labelId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","blockInputOverrides":true,"domain":"input_boolean","service":"turn_on","x":600,"y":280,"wires":[[]]},{"id":"1973e0e5228a83d5","type":"alexa-remote-routine","z":"0788ddb2e2fd1ae7","g":"e9b2d6eba604518c","name":"TTS nas Alexas","account":"0b0dcfaefb34f2b7","routineNode":{"type":"speak","payload":{"type":"announcement","text":{"type":"str","value":"Você abriu a porta da lava louças?"},"devices":["G090XG1221760K8K","G090XG12210201R1"]}},"x":1400,"y":580,"wires":[[]]},{"id":"48ec64a307b2fac6","type":"delay","z":"0788ddb2e2fd1ae7","g":"e9b2d6eba604518c","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":470,"y":680,"wires":[["271e6996c28ecf80"]]},{"id":"check-state","type":"switch","z":"0788ddb2e2fd1ae7","g":"e9b2d6eba604518c","name":"Verificar estado do sensor","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"off","vt":"str"},{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":940,"y":520,"wires":[["check-notifications"],["disable-notifications"]]},{"id":"check-notifications","type":"switch","z":"0788ddb2e2fd1ae7","g":"e9b2d6eba604518c","name":"Notificações Ativas?","property":"flow.notificationsEnabled","propertyType":"flow","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":920,"y":580,"wires":[["send-notification"],[]]},{"id":"send-notification","type":"trigger","z":"0788ddb2e2fd1ae7","g":"e9b2d6eba604518c","name":"Enviar notificações repetidas","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"2","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"","outputs":2,"x":930,"y":640,"wires":[["48ec64a307b2fac6","1973e0e5228a83d5"],[]]},{"id":"disable-notifications","type":"change","z":"0788ddb2e2fd1ae7","g":"e9b2d6eba604518c","name":"Desativar notificações","rules":[{"t":"set","p":"flow.notificationsEnabled","pt":"flow","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":900,"y":460,"wires":[["14f562b643809b13"]]},{"id":"2f58c2c0819d89c0","type":"change","z":"0788ddb2e2fd1ae7","g":"e9b2d6eba604518c","name":"Ativar notificações","rules":[{"t":"set","p":"flow.notificationsEnabled","pt":"flow","to":"true","tot":"bool"}],"x":1370,"y":460,"wires":[[]]},{"id":"14f562b643809b13","type":"delay","z":"0788ddb2e2fd1ae7","g":"e9b2d6eba604518c","name":"Bloqueio de 10 minutos","pauseType":"delay","timeout":"10","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1130,"y":460,"wires":[["2f58c2c0819d89c0"]]},{"id":"ae7b442bf5603d76","type":"api-call-service","z":"0788ddb2e2fd1ae7","g":"e9b2d6eba604518c","name":"Sensor Cozinha - C/ Movimento","server":"ce62d31.41e203","version":7,"debugenabled":false,"action":"input_boolean.turn_on","floorId":[],"areaId":[],"deviceId":[],"entityId":["input_boolean.movimento_na_cozinha"],"labelId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","blockInputOverrides":true,"domain":"input_boolean","service":"turn_on","x":600,"y":560,"wires":[["check-state"]]},{"id":"ce62d31.41e203","type":"server","name":"Home Assistant","addon":true,"rejectUnauthorizedCerts":true,"ha_boolean":"","connectionDelay":false,"cacheJson":false,"heartbeat":false,"heartbeatInterval":"10","statusSeparator":"","enableGlobalContextStore":false},{"id":"0b0dcfaefb34f2b7","type":"alexa-remote-account","name":"Vinicius","authMethod":"proxy","proxyOwnIp":"192.168.10.8","proxyPort":"3456","cookieFile":"/config/senha","refreshInterval":"1","alexaServiceHost":"pitangui.amazon.com","amazonPage":"amazon.com.br","acceptLanguage":"pt-BR","onKeywordInLanguage":"on","userAgent":"","useWsMqtt":"on","autoInit":"on"}]


## Main Components

### Top flow

### 1. **Lava Louças Power**
   - **Node Type**: `server-state-changed`
   - **Description**: Monitors the state of the dishwasher power (`sensor.tomada_lava_loucas_power`). When the power state changes, the flow is triggered.

### 2. **Power State Check**
   - **Node Type**: `switch`
   - **Description**: Checks if the power state is >= to 10 and sends to the first output, when reaches >= 80 sends another notification to the second output.

### 3. **Lava Louças - Ligada**
   - **Node Type**: `input_boolean`
   - **Description**: Input boolean entity created so we can define when the dishwasher is turned on or off based in the power state.
   - **Action**: `input_boolean.turn_on`

### 4. **Lava Louças - Funcionando**
   - **Node Type**: `input_select`
   - **Description**: Input select entity created with `running` and `clean` options to be selected.
   - **Data**: `{"option":"Running"}`

### Mid Flow

### 1. **Cozinha - Movimento**
   - **Node Type**: `binary_sensor`
   - **Description**: Monitors the state of the kitchen mmwave sensor (`binary_sensor.sensor_presenca_cozinha_presence`) and then sends the state to an input_boolean entity created to define if there was moviment in the kitchen and send (or not) another notification after "X" minutes the cycle was finished.

### 2. **Sensor Cozinha - S/ Movimento**
   - **Node Type**: `input_boolean`
   - **Description**: Input boolean entity created so we can define if there was or not moviment in the mmwave sensor of the kitchen.
   - **Action**: `input_boolean.turn_off`
   - 
### 3. **Sensor Cozinha - C/ Movimento**
   - **Node Type**: `input_boolean`
   - **Description**:  Input boolean entity created so we can define if there was or not moviment in the mmwave sensor of the kitchen.
   - **Action**: `input_boolean.turn_on`
     
## Bottom flow

To be continued...
